<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AnimeTube Pro — Red Neon Edition</title>
<style>
:root{
  --bg:#090909;
  --card:#161616;
  --muted:#888;
  --accent:rgb(255,30,30);
  --glass:rgba(255,255,255,0.04);
}
*{box-sizing:border-box;font-family:Inter,system-ui}
body{margin:0;background:#050505 url('bg.jpg') center/cover fixed;color:#eee}
header{display:flex;align-items:center;gap:18px;padding:12px 20px;background:rgba(0,0,0,0.55);backdrop-filter:blur(8px);position:sticky;top:0;z-index:10;border-bottom:1px solid rgba(255,50,50,0.3)}
.logo{display:flex;align-items:center;gap:10px;font-size:20px;font-weight:700;color:var(--accent);text-shadow:0 0 8px var(--accent)}
.logo img{width:40px;height:40px;border-radius:10px}
#headerAvatar{width:40px;height:40px;border-radius:50%;border:2px solid var(--accent);cursor:pointer;box-shadow:0 0 10px var(--accent)}
.search{flex:1;display:flex;align-items:center;background:var(--card);padding:8px;border-radius:9px}
.search input{flex:1;background:transparent;border:0;color:#fff;font-size:15px;outline:none}
.btn{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:white;cursor:pointer;font-weight:600;box-shadow:0 0 10px var(--accent)}
.btn.ghost{background:transparent;border:1px solid rgba(255,80,80,0.3)}
.layout{display:grid;grid-template-columns:260px 1fr;gap:18px;padding:18px}
nav.side{background:rgba(0,0,0,0.6);padding:14px;border-radius:12px;height:calc(100vh - 120px);overflow:auto}
nav.side a{display:block;padding:10px 12px;margin-bottom:8px;border-radius:8px;color:#fff;text-decoration:none;cursor:pointer}
nav.side a:hover{background:rgba(255,20,20,0.1);box-shadow:0 0 8px var(--accent)}
.player-card{background:rgba(0,0,0,0.55);padding:14px;border-radius:12px;border:1px solid rgba(255,50,50,0.2)}
video{width:100%;max-height:520px;border-radius:10px;background:#000;border:1px solid rgba(255,0,0,0.3);box-shadow:0 0 25px rgba(255,0,0,0.4)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;margin-top:12px}
.card{background:rgba(0,0,0,0.5);padding:10px;border-radius:10px;cursor:pointer;position:relative;border:1px solid rgba(255,20,20,0.2)}
.card:hover{box-shadow:0 0 15px var(--accent)}
.del-btn{position:absolute;top:5px;right:5px;background:var(--accent);border:none;padding:5px 8px;border-radius:6px;color:#fff;font-size:11px;cursor:pointer}
.footer{text-align:center;color:var(--muted);padding:20px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);justify-content:center;align-items:center;z-index:200}
.modal-box{background:#111;border-radius:14px;padding:22px;width:360px;border:1px solid rgba(255,0,0,0.4);box-shadow:0 0 20px var(--accent)}
.modal-box h2{text-align:center;color:var(--accent)}
.modal input{width:100%;margin:6px 0;padding:10px;border-radius:8px;border:1px solid rgba(255,50,50,0.3);background:#000;color:#fff}
.avatar-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
.avatar-grid img{width:70px;height:70px;border-radius:50%;cursor:pointer;border:2px solid transparent}
.avatar-grid img:hover{border-color:var(--accent);box-shadow:0 0 10px var(--accent)}
.avatar-selected{border-color:var(--accent) !important;box-shadow:0 0 10px var(--accent) !important}
</style>
</head>
<body>
<header>
  <div class="logo"><img src="main.png" alt="logo">AnimeTube Pro</div>
  <div class="search"><input id="searchBox" placeholder="Search anime…"><button class="btn ghost" id="searchBtn">Search</button></div>
  <div style="display:flex;align-items:center;gap:10px">
    <div id="profileSection"></div>
    <button class="btn" id="loginBtn"><img src="main.png" width="18"> Login/Register</button>
    <label class="btn" for="fileUpload" id="uploadBtn" style="display:none"><img src="admin.jpg" width="18"> Upload</label>
    <input id="fileUpload" type="file" accept="video/*" multiple style="display:none">
    <button class="btn ghost" id="toggleMusic">Music</button>
  </div>
</header>
<div class="layout">
  <nav class="side">
    <a>All</a><a>Action</a><a>Romance</a><a>Adventure</a>
  </nav>
  <main>
    <section class="player-card"><video id="mainVideo" controls></video><div class="meta"><h2 id="videoTitle">Select a video…</h2></div></section>
    <section class="grid" id="thumbGrid"></section>
    <section class="playlist-card" id="playlistSection" style="margin-top:16px">
      <h3 style="color:var(--accent)">Playlist</h3>
      <div id="playlistGrid" class="grid"></div>
    </section>
  </main>
</div>
<div class="modal" id="modal">
  <div class="modal-box">
    <h2>Login / Register</h2>
    <input id="usernameInput" placeholder="Username">
    <input id="passwordInput" type="password" placeholder="Password">
    <p style="margin:6px 0;color:#bbb;text-align:center">Choose your avatar</p>
    <div class="avatar-grid" id="avatarGrid"></div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" id="loginSubmit"><img src="login.png" width="18"> Login</button>
      <button class="btn ghost" id="registerSubmit"><img src="registration.png" width="18"> Register</button>
    </div>
  </div>
</div>
<button id="adminLoginBtn" style="position:fixed;bottom:20px;right:20px;background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:#fff;z-index:50">Admin Login</button>
<script src="https://cdn.jsdelivr.net/npm/tsparticles@2.10.1/tsparticles.bundle.min.js"></script>
<script>
const videos=[], AVATARS=['1.jpg','2.jpg','3.jpg','4.jpg','5.jpg','6.jpg','7.jpg','8.jpg','9.jpg','10.jpg','11.jpg','12.jpg','13.jpg','14.jpg','15.jpg','16.jpg'], ADMIN_AVATAR='admin.jpg', GENRES=['All','Action','Romance','Adventure'];
let users=[{username:'admin',password:'admin123',role:'admin',profile:ADMIN_AVATAR,playlist:[]},{username:'user',password:'1234',role:'user',profile:AVATARS[0],playlist:[]}];
let currentUser=null, currentGenre='All', currentPlayingId=null;

const modal=document.getElementById('modal'), avatarGrid=document.getElementById('avatarGrid'), usernameInput=document.getElementById('usernameInput'), passwordInput=document.getElementById('passwordInput'), loginBtn=document.getElementById('loginBtn'), loginSubmit=document.getElementById('loginSubmit'), registerSubmit=document.getElementById('registerSubmit'), profileSection=document.getElementById('profileSection'), adminLoginBtn=document.getElementById('adminLoginBtn'), fileUpload=document.getElementById('fileUpload'), uploadBtn=document.getElementById('uploadBtn'), thumbGrid=document.getElementById('thumbGrid'), playlistGrid=document.getElementById('playlistGrid'), playlistSection=document.getElementById('playlistSection'), mainVideo=document.getElementById('mainVideo'), videoTitle=document.getElementById('videoTitle'), toggleMusic=document.getElementById('toggleMusic');

let selectedAvatarIndex=0;

// Render avatars
function renderAvatarGrid(){
  avatarGrid.innerHTML='';
  AVATARS.forEach((src,i)=>{
    const img=document.createElement('img'); img.src=src; img.dataset.idx=i;
    img.onclick=()=>{
      avatarGrid.querySelectorAll('img').forEach(x=>x.classList.remove('avatar-selected'));
      img.classList.add('avatar-selected'); selectedAvatarIndex=i;
      if(currentUser&&currentUser.role==='admin'){ currentUser.profile=AVATARS[i]; updateHeaderAvatar(); alert('Admin avatar updated!'); }
    };
    if(i===0) img.classList.add('avatar-selected');
    avatarGrid.appendChild(img);
  });
}
renderAvatarGrid();

function updateHeaderAvatar(){
  if(currentUser){
    profileSection.innerHTML=`<div style="display:flex;align-items:center;gap:8px">
      <img src="${currentUser.profile}" id="headerAvatar" alt="avatar" style="width:40px;height:40px;border-radius:50%">
      <div style="color:#fff">${currentUser.username}</div>
      <button id="logoutBtn" class="btn ghost" style="margin-left:8px">Logout</button>
    </div>`;
    document.getElementById('logoutBtn').onclick=logout;
    loginBtn.style.display='none';
  } else { profileSection.innerHTML=''; loginBtn.style.display='inline-block'; }
}

function applyUserToUI(){
  updateHeaderAvatar();
  uploadBtn.style.display=currentUser&&currentUser.role==='admin'?'inline-block':'none';
  playlistSection.style.display=currentUser&&currentUser.role==='user'?'block':'none';
}

// Login/Register
loginBtn.onclick=()=>{ modal.style.display='flex'; }
modal.onclick=e=>{ if(e.target===modal) modal.style.display='none'; }
loginSubmit.onclick=()=>{ const u=usernameInput.value.trim(),p=passwordInput.value.trim(); const user=users.find(x=>x.username===u&&x.password===p); if(!user){ alert('Invalid credentials'); return; } currentUser=user; modal.style.display='none'; applyUserToUI(); renderThumbs(currentGenre); }
registerSubmit.onclick=()=>{ const u=usernameInput.value.trim(),p=passwordInput.value.trim(); if(!u||!p){ alert('Enter username + password'); return; } if(users.find(x=>x.username===u)){ alert('Username exists'); return; } const profile=AVATARS[selectedAvatarIndex]; const user={username:u,password:p,role:'user',profile:profile,playlist:[]}; users.push(user); currentUser=user; modal.style.display='none'; applyUserToUI(); renderThumbs(currentGenre); }
adminLoginBtn.onclick=()=>{ const u=prompt('Admin username:'),p=prompt('Admin password:'); if(u==='admin'&&p==='admin123'){ currentUser=users.find(x=>x.role==='admin'); applyUserToUI(); alert('Admin logged in!'); renderThumbs(currentGenre); }else alert('Invalid admin creds'); }
function logout(){ currentUser=null; mainVideo.src=''; videoTitle.textContent='Select a video…'; selectedAvatarIndex=0; updateHeaderAvatar(); uploadBtn.style.display='none'; playlistSection.style.display='none'; renderThumbs('All'); }

// Side nav
document.querySelectorAll('nav.side a').forEach(a=>{ a.onclick=e=>{ e.preventDefault(); currentGenre=a.textContent; renderThumbs(currentGenre); }; });

// Upload
fileUpload.addEventListener('change',async e=>{ if(!currentUser||currentUser.role!=='admin'){ alert('Only admin can upload'); return; } for(const file of e.target.files){ const id=Date.now()+Math.random(); const src=URL.createObjectURL(file); let thumb=await genThumb(file); const title=prompt('Enter title:',file.name.replace(/\.[^/.]+$/,''))||'Untitled'; let genre=prompt(`Enter genre (${GENRES.slice(1).join(', ')}):`,'Action'); if(!GENRES.includes(genre)) genre='Action'; videos.push({id,src,thumb,title,genre}); renderThumbs(currentGenre); } });
async function genThumb(file){ return new Promise(res=>{ const url=URL.createObjectURL(file), v=document.createElement('video'); v.src=url; v.muted=true; v.onloadedmetadata=()=>{ try{v.currentTime=1}catch(e){} }; v.onseeked=()=>{ const c=document.createElement('canvas'); c.width=300; c.height=170; c.getContext('2d').drawImage(v,0,0,300,170); c.toBlob(b=>res(URL.createObjectURL(b)),'image/jpeg',0.7); }; }); }

// Render videos with playlist button
function renderThumbs(genre){
  thumbGrid.innerHTML='';
  const filtered=genre==='All'?videos:videos.filter(v=>v.genre===genre);
  filtered.forEach(v=>{
    const card=document.createElement('div'); card.className='card';
    let adminButtons=currentUser&&currentUser.role==='admin'?`<button class='del-btn' onclick='delVid(${v.id})'>Delete</button>`:'';
    let userPlaylistBtn=currentUser&&currentUser.role==='user'?`<button class='btn ghost' style='position:absolute;bottom:8px;right:8px;font-size:11px' onclick='addToPlaylist(${v.id},event)'>➕</button>`:'';
    card.innerHTML=`${adminButtons}<img src='${v.thumb}' style='width:100%;border-radius:8px'><h4 style='margin:8px 0;color:#fff'>${v.title}</h4>${userPlaylistBtn}`;
    card.onclick=()=>{ play(v); };
    thumbGrid.appendChild(card);
  });
  renderPlaylist();
}

// Playlist functions
function addToPlaylist(videoId,e){ e.stopPropagation(); if(!currentUser||currentUser.role!=='user'){ alert('Only users can add to playlist'); return; } const video=videos.find(v=>v.id===videoId); if(!video) return; if(currentUser.playlist.find(v=>v.id===videoId)){ alert('Already in playlist'); return; } currentUser.playlist.push(video); renderPlaylist(); }
function renderPlaylist(){ playlistGrid.innerHTML=''; if(!currentUser||currentUser.role!=='user') return; currentUser.playlist.forEach(v=>{ const item=document.createElement('div'); item.className='card'; item.style.display='flex'; item.style.alignItems='center'; item.style.gap='8px'; item.style.cursor='pointer'; if(v.id===currentPlayingId) item.style.boxShadow='0 0 20px var(--accent)'; item.innerHTML=`<img src='${v.thumb}' style='width:60px;height:40px;border-radius:6px;object-fit:cover'><div style='color:#fff'>${v.title}</div>`; item.onclick=()=>{ play(v); currentPlayingId=v.id; renderPlaylist(); }; playlistGrid.appendChild(item); }); }

function play(v){ mainVideo.src=v.src; videoTitle.textContent=v.title; mainVideo.play(); currentPlayingId=v.id; renderPlaylist(); }
function delVid(id){ if(!currentUser||currentUser.role!=='admin'){ alert('Only admin can delete'); return; } const i=videos.findIndex(x=>x.id===id); if(i>-1){ if(videos[i].id===currentPlayingId) currentPlayingId=null; videos.splice(i,1); renderThumbs(currentGenre); } }
window.delVid=delVid;

// Music
const bg=new Audio('bg-music.mp3'); bg.loop=true; bg.volume=0.4; try{bg.play()}catch(e){}
toggleMusic.onclick=()=>{ if(bg.paused) bg.play(); else bg.pause(); }

// Initial render
renderThumbs('All');
</script>
</body>
</html>
